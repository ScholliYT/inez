@page "/shoppinglist"
@inherits INEZ.Pages.ShoppingListModel
@using System.Security.Claims;

<h3>Einkaufsliste </h3>

<AuthorizeView>
    <NotAuthorized>
        <p><em>Bitte Melde dich an um die Einkaufsliste nutzen zu können.</em></p>
    </NotAuthorized>
    <Authorized>
        @if (SetCurrentUserId(context.User.FindFirstValue(ClaimTypes.NameIdentifier)) && ShoppingListItems == null)
        {
            <p><em>Lade...</em></p>
        }
        else
        {
            <div class="container">
                <div class="row" style="margin-bottom: 10px">
                    <div class="col-md-3">
                        <button class="btn btn-primary" type="button" @onclick=@AddNew>Hinzufügen</button>
                    </div>
                    <div class="col">
                        <form class="form-grid">
                            <div class="input-group mb-auto">
                                <input type="search" class="form-control" @bind-value="@SearchTerm" bind-Value:event="oninput" />
                                <div class="input-group-append">
                                    <button class="btn btn-secondary" type="button" @onclick="@SearchClick">Suchen/Hinzufügen</button>
                                    <button class="btn btn-danger" type="button" @onclick="@ClearClick"><span class="oi oi-trash"/></button>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="usefuzzysearch" @bind-value="@UseFuzzySearch" />
                                    <label class="form-check-label" for="usefuzzysearch">Fuzzy Suche</label>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th style="width: 20%">@QuantitiyColumnName</th>
                                    <th style="width: 70%">@NameColumnName</th>
                                    <th style="width: 10%"></th> @*for buttons*@
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var shoppingListItem in ShoppingListItems)
                                {
                                    <tr>
                                        <td>@shoppingListItem.Quantity</td>
                                        <td>@shoppingListItem.Name</td>
                                        <td>
                                            <div class="btn-group">
                                                <button type="button" class="btn btn-light" @onclick=@(() => EditItem(shoppingListItem.Id))><span class="oi oi-pencil"/></button>
                                                <button type="button" class="btn btn-danger" @onclick=@(() => ConfirmDelete(shoppingListItem))><span class="oi oi-trash"/></button>
                                            </div>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        }

    </Authorized>
</AuthorizeView>